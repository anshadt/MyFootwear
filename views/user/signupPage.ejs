<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FootWear</title>
    <link rel="shortcut icon" href="/images/iconshoe.jpg" type="">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"/>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/public/style.css" />
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <style>
      .divider:after,
      .divider:before {
        content: "";
        flex: 1;
        height: 1px;
        background: #eee;
      }
      .h-custom {
        height: calc(100% - 73px);
      }
      @media (max-width: 450px) {
        .h-custom {
          height: 100%;
        }
      }
      .gradient-custom-4 {
        
        background: #84fab0;

       
        background: -webkit-linear-gradient(
          to right,
          rgba(132, 250, 176, 1),
          rgba(143, 211, 244, 1)
        );

        background: linear-gradient(
          to right,
          rgba(132, 250, 176, 1),
          rgba(143, 211, 244, 1)
        );
      }
      .btn-google {
            background-color: #534af3;
            color: black;
            display: flex;
            align-items: center;
        }
        .btn-google img {
            height: 20px;
            margin-right: 10px;
        }
    </style>
  </body>
</html>

<section
  class="vh-100 bg-image"
  style="
    background-image: url('/images/nike-5041716_1280.jpg');">
  <div class="mask d-flex align-items-center h-100 gradient-custom-3">
    <div class="container h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col-12 col-md-10 col-lg-8 col-xl-6">
          <div class="card" style="border-radius: 15px">
            <div class="card-body p-4 p-md-5">
              <h2 class="text-uppercase text-center mb-4">Create an account</h2>
              <form onsubmit="" action="#" method="post" >
                <!-- Name Input -->
                <div class="form-outline mb-4">
                  <label class="form-label" for="form3Example1cg">Enter Your Name</label>
                  <input type="text" id="userName" class="form-control form-control-lg" placeholder="Enter Name" name="name"required/>
                  
                 
                </div>
                <!-- Email Input -->
                <div class="form-outline mb-4">
                  <p class="text-danger"><%= locals.message ? message:null %></p>
                  <label class="form-label" for="form3Example3cg">Enter Your Email</label>
                  <input type="email"id="email" class="form-control form-control-lg" placeholder="Enter a valid email address" name="email"required/>
                  <p id="result"></p>
                </div>

                <!-- Password Input -->
                <div class="form-outline mb-4">
                  <label class="form-label" for="form3Example4cg">Enter Password</label>
                  <input
                    type="password"
                    id="password"
                    class="form-control form-control-lg" placeholder="Enter Password" name="password"
                    required
                  />
                 
                </div>

                <!-- Repeat Password Input -->
                <div class="form-outline mb-4">
                  <p class="text-danger"><%= locals.message ? message:null %></p>
                  <label class="form-label" for="form3Example4cdg">Re-Enter Password</label>
                  <input
                    type="password"
                    id="cPassword"
                    class="form-control form-control-lg"placeholder="Re-Enter Password" name="cPassword"
                    required
                  />
                </div>
                <div class="form-outline mb-4">
                  <label class="form-label" for="referralCode">Referral Code (Optional)</label>
                  <input type="text" id="referralCode" class="form-control form-control-lg" placeholder="Enter Referral Code if any" name="referralUsed" />
                </div>

                <!-- Register Button -->
                <div class="d-flex justify-content-center mb-4">
                  <button onclick="singupClick(event)" type="submit" class="btn btn-success btn-lg gradient-custom-4 text-body">Register</button>
                </div>
                <div class="d-flex justify-content-center mb-4">
                  <a href="/auth/google" class="btn btn-google btn-lg">
                      <img src="/images/google.png">
                      Signup with Google
                  </a>
              </div>

                <!-- Login Link -->
                <p class="text-center text-muted mt-4 mb-0">
                  Have already an account?
                  <a href="/login" class="fw-bold text-body"><u>Login here</u></a>
                </p>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
</body>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<script>
  function singupClick(event){
    event.preventDefault();

    const userName = document.getElementById('userName').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    const cpassword = document.getElementById('cPassword').value.trim();
    const referralUsed = document.getElementById('referralCode').value.trim();

    if (!userName || !email || !password || !cpassword) {
      Swal.fire({
          title:"Error",
          text:"All fields must be filled",
          icon:"error"
      });
      return;
    }
    if (!/^[a-zA-Z\s]+$/.test(userName)) {
      Swal.fire({
        title:'Error',
        text:"Name must contain letters and cannot be empty",
        icon:"error"
      });
      return;
    }
    if (password !== cpassword) {
      Swal.fire({
        title:'Error',
        text:"Incorrect confirm password",
        icon:"error"
      });
      return;
    }

    if (password.length < 6 || /\s/.test(password)) {
      Swal.fire({
        title:'Error',
        text:"Password must be at least 6 characters and contain no spaces",
        icon:"error"
      });
      return;
    }
    
    fetch("/signup", {
        method: 'POST',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ name: userName, email, password,referralUsed })
    })
    .then((res) => res.json())
    .then((data) => {
      if (data.success) {
        Swal.fire({
          title: 'Success',
          text: "Signup successful",
          icon: "success",
          timer: 1000
        }).then(() => {
          window.location.href = "/otpPage";
        });
      } else if (data.error) {
        Swal.fire({
          title: "Error",
          text: data.error,
          icon: "error"
        });
      }
    })
    .catch((error) => {
      Swal.fire({
        title: "Oops!",
        text: "Something went wrong! Please try again",
        icon: "error"
      });
    });
  }
</script>


<!-- <script>
  const validateEmail = (email) => {
  return email.match(
    /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
  );
};

const validate = () => {
  const $result = $('#result');
  const email = $('#email').val();
  $result.text('');

  if(validateEmail(email)){
    $result.text(email + ' is valid.');
    $result.css('color', 'green');
  } else{
    $result.text(email + ' is invalid.');
    $result.css('color', 'red');
  }
  return false;
}

$('#email').on('input', validate);
</script> -->

<script>
  const validateEmail = (email) => {
    return email.match(
      /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
    );
  };

  const validateName = (name) => {
    return name.length >= 3; 
  };

  // const validatePassword = (password) => {
  //   return /^(?=.*[0-9])(?=.*[a-zA-Z]).{8,}$/.test(password); 
  // };

  const validatePassword = (password) => {
    return password.length >= 6; 
  };


  const validateConfirmPassword = (password, confirmPassword) => {
    return password === confirmPassword; // Check if both passwords match
  };

  const updateMessage = (inputId, message, isValid) => {
    const $result = $(`#${inputId}-message`);
    if (!$result.length) {
      $(`#${inputId}`).after(`<p id="${inputId}-message"></p>`);
    }

    $(`#${inputId}-message`)
      .text(message)
      .css('color', isValid ? 'green' : 'red');
  };

  const validateField = (field) => {
    const fieldId = field.id;
    const value = field.value;

    if (fieldId === 'userName') {
      if (validateName(value)) {
        updateMessage(fieldId, 'Name is Valid!', true);
      } else {
        updateMessage(fieldId, 'Name must be at least 3 characters long.', false);
      }
    } else if (fieldId === 'email') {
      if (validateEmail(value)) {
        updateMessage(fieldId, `${value} is valid.`, true);
      } else {
        updateMessage(fieldId, 'Email is invalid.', false);
      }
    } else if (fieldId === 'password') {
      if (validatePassword(value)) {
        updateMessage(fieldId, 'Password is valid', true);
      } else {
        updateMessage(
          fieldId,
          'Password must be at least 6 characters.',
          false
        );
      }
    } else if (fieldId === 'cPassword') {
      const password = $('#password').val();
      if (validateConfirmPassword(password, value)) {
        updateMessage(fieldId, 'Passwords match!', true);
      } else {
        updateMessage(fieldId, 'Passwords do not match.', false);
      }
    }
  };

  // Attach event listeners for real-time validation
  $('#userName').on('input', function () {
    validateField(this);
  });

  $('#email').on('input', function () {
    validateField(this);
  });

  $('#password').on('input', function () {
    validateField(this);
  });

  $('#cPassword').on('input', function () {
    validateField(this);
  });

  // Prevent form submission if validation fails
  $('form').on('submit', function (e) {
    const isValid =
      validateName($('#userName').val()) &&
      validateEmail($('#email').val()) &&
      validatePassword($('#password').val()) &&
      validateConfirmPassword($('#password').val(), $('#cPassword').val());

    if (!isValid) {
      e.preventDefault();
    }
  });
</script>




</body>
</html>
