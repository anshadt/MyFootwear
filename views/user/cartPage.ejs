<%- include('../../views/partials/userHeader') %>
<link rel="stylesheet" href="css/icomoon.css">
<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,500,600,700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Rokkitt:100,300,400,700" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">



  <style>
      .icon-hover-primary:hover {
    border-color: #3b71ca !important;
    background-color: white !important;
  }
  
  .icon-hover-primary:hover i {
    color: #3b71ca !important;
  }
  .icon-hover-danger:hover {
    border-color: #dc4c64 !important;
    background-color: white !important;
  }
  
  .icon-hover-danger:hover i {
    color: #dc4c64 !important;
  }
  
      body {
        background-color: #f8f9fa;
        padding-top: 80px;
       
      }
      .sidebar {
        height: 100vh;
        background-color: #2c3e50;
        position: fixed;
        padding-top: 5rem;
      }
      .sidebar a {
        color: white;
        transition: background-color 0.3s ease;
      }
      .sidebar a:hover {
        background-color: #34495e;
      }
      .profile-header {
        background-color: #00bcd4; /* Teal 300 */
        color: white;
        padding: 20px;
        text-align: center;
      }
      .profile-pic {
        width: 150px;
        height: 150px;
        object-fit: cover;
        border-radius: 50%;
        border: 5px solid white;
        transition: transform 0.3s;
      }
      .profile-pic:hover {
        transform: scale(1.1);
      }
      .profile-card {
        margin-top: 20px;
        z-index: 1;
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .address-card {
        background: #f1f1f1;
        border-radius: 5px;
        padding: 15px;
        margin-bottom: 10px;
        position: relative;
        transition: background 0.3s;
      }
      .address-card:hover {
        background: #e1e1e1;
      }
  
      .dropdown-menu {
    padding: 0;
    margin: 0;
  }
  
  .profile-link {
    display: flex;
    align-items: center;
    text-decoration: none;
    color: inherit;
    padding: 8px 16px;
    transition: background-color 0.2s ease; 
  }
  
  .profile-link:hover {
    background-color: #f0f0f0; 
  }
  
  .profile-avatar {
    width: 24px; 
    height: 24px;
    border-radius: 50%; 
    margin-right: 8px; 
  }
  
  .logout-link {
    margin-bottom: 8px; 
  }
  .fixed-header {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    z-index: 1000; 
  }
  
  .content-section {
    margin-top: 20px; 
  }
  
  .breadcrumb {
              background-color: #f8f9fa; 
              border-radius: 0.375rem;
              padding: 0.75rem 1rem;
              box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); 
          }
  
          .breadcrumb-item + .breadcrumb-item::before {
              content: ">";
              color: #6c757d;
          }
  
          .breadcrumb-item a {
              text-decoration: none;
              color: #007bff;
          }
  
          .breadcrumb-item a:hover {
              text-decoration: underline;
          }
  
          .breadcrumb-item.active {
              color: #6c757d; 
          }
    </style>
    <header class="header_section bg-dark fixed-header">
      <div class="container">
        <nav class="navbar navbar-expand-lg custom_nav-container">
          <a class="navbar-brand" href="/userHomePage">
            <span>
              Footwear
            </span>
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
            <span class=""> </span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mx-auto">
              <li class="nav-item active">
                <a class="nav-link" href="/userHomePage">Home <span class="sr-only">(current)</span></a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">About us</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">Contact us</a>
              </li>
            </ul>
    
            
            <div class="user_option">
              <a class="cart_link position-relative" href="/getCartPage">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 456.029 456.029" width="50" height="50">
                  <path d="M345.6 338.862c-29.184 0-53.248 23.552-53.248 53.248s23.552 53.248 53.248 53.248 53.248-23.552 53.248-53.248-23.552-53.248-53.248-53.248zM439.296 84.91h-330.56l-5.12-34.304c-2.048-13.824-21.504-30.72-44.544-30.72H20.48C9.216 19.886 0 29.102 0 40.366S9.216 60.846 20.48 60.846h41.472c2.56 0 4.608 2.048 5.12 4.608l31.744 216.064c4.096 27.136 27.648 47.616 55.296 47.616h212.992c26.624 0 49.664-18.944 55.296-45.056l33.28-166.4c4.096-21.504-3.072-32.256-14.336-34.304zM215.04 389.55c-1.024-28.16-24.576-50.688-52.736-50.688-29.696 1.536-52.224 26.112-51.2 55.296 1.024 28.16 24.064 50.688 52.224 50.688 29.184 0 52.224-24.576 51.712-55.296z"/>
                </svg>
                
                <span id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                  <%= cartCount %>
                </span>
              </a>
              <a class="cart_link position-relative" href="/wishlist">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="50" height="50" fill="red">
                  <path d="M462.3 62.7C407 7.4 324.8 23.9 270.1 79.1L256 93.3l-14.1-14.2c-54.8-55.2-136.9-71.7-192.2-16.4S-7.4 199.9 48 255.2L239 445.5c7.4 7.5 19.6 7.5 27 0l205.4-205.4c55.2-54.8 71.7-136.9 16.4-192.2z"/>
                </svg>
                <span data-toggle="tooltip" data-placement="bottom" title="<%= wishlistCount %>" id="cartCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                  <%= wishlistCount %>
                </span>
              </a>
              <p class="user_proname"><%= user.name %></p>
    
              <div class="dropdown">
                <button class="btn btn-secondary dropdown-toggle" type="button" id="loginDropdown" data-bs-toggle="dropdown">
                  <i class="fa fa-user" aria-hidden="true"></i>
                </button>
    
                <div class="dropdown-menu">
                  <a href="/profilePage" class="profile-link">
                    <img src="/images/profile.png" class="profile-avatar"> Profile
                  </a>
                  <a href="/orderHistory" class="profile-link">
                    <img src="/images/purchase-order.png" class="profile-avatar"> Orders
                  </a>
                  <a href="/getCartPage" class="profile-link">
                    <img src="/images/shopping-cart (1).png" class="profile-avatar"> Cart
                  </a>
                  <a href="wishlist" class="profile-link">
                    <img src="/images/wishlist.png" class="profile-avatar"> Wishlist
                  </a>
                  <a href="/loadWalletPage" class="profile-link">
                    <img src="/images/wallet.png" class="profile-avatar"> Wallet
                  </a>
                  <a href="/logout"class="profile-link logout-link">
                    <img src="/images/shutdown.png" class="profile-avatar"> Logout
                  </a>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <div class="bg-light">
      <div class="container py-4">
        
        <nav class="d-flex">
          <h6 class="mb-0 mt-5">
            <a href="/userHomePage" class="text-blue-50">Home</a>
            <span class="text-black-50 mx-2"> > </span>
            <a href="" class="text-black"><u>Shopping cart</u></a>
          </h6>
        </nav>
       
      </div>
    </div>
      
      
      <section class="bg-light my-5">
        <div class="container">
          <div class="row">
            <!-- cart -->
            <div class="col-lg-9">
              <div class="card border shadow-0">
                <div class="m-4">
                  <h4 class="card-title mb-4">Your shopping cart</h4>
                  <% if (cart && cart.items.length > 0) { %>
                    <% cart.items.forEach(item => { %>
                      <div class="cart-item" data-item-id="<%= item._id %>">
                        <div class="row gy-3 mb-4">
                          <div class="col-lg-5">
                            <div class="me-lg-5">
                              <div class="d-flex">
                                <img src="<%= item.product.images[0] %>" class="border rounded me-3" style="width: 96px; height: 96px;" />
                                <div class="">
                                  <a href="#" class="nav-link"><%= item.product.productname %></a>
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-lg-2 col-sm-6 col-6 d-flex flex-row flex-lg-column flex-xl-row text-nowrap">
                            <div class="quantity-control">
                              <button class="quantity-btn minus">-</button>
                              <input type="number" class="quantity-input" value="<%= item.quantity %>" min="1" max="5" readonly>
                              <button class="quantity-btn plus">+</button>
                            </div>
                            <div class="">
                              <text class="h6">â‚¹<span class="price-value"><%= item.price.toFixed(2) %></span></text> <br />
                              
                              <small class="text-muted text-nowrap"> â‚¹<%= item.price / item.quantity %> / per item </small>
                              
                            </div>
                          </div>
                          <div class="col-lg col-sm-6 d-flex justify-content-sm-center justify-content-md-start justify-content-lg-center justify-content-xl-end mb-2">
                            <div class="float-md-end">
                             
                              <a href="#!" class="btn btn-light border px-2 icon-hover-primary"><i class="fas fa-heart fa-lg px-1 text-secondary"></i></a>
                              
                              <button class="remove-item-btn btn btn-outline-danger" data-item-id="<%= item._id %>">Remove</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    <% }) %>
                  <% } else { %>
                    <p>Your cart is empty.</p>
                  <% } %>
                </div>
                <div class="border-top pt-4 mx-4 mb-4">
                  <p><i class="fas fa-truck text-muted fa-lg"></i> Free Delivery within 1-2 Hours</p>
                  <p class="text-muted">
                    Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
                    aliquip
                  </p>
                </div>
              </div>
            </div>
            
            <div class="col-lg-3">
              <div class="card mb-3 border shadow-0">
              </div>
              <div class="card shadow-0 border">
                <div class="card-body">
                  <div class="d-flex justify-content-between">
                    <p class="mb-2">Total Item Qty:</p>
                    <p class="mb-2"><%= cartCount.toFixed(2) %></p>
                  </div>
                  <hr />
                  <div class="d-flex justify-content-between">
                    <p class="mb-2">Total Amount:</p>
                    <p id="cart-total" class="mb-2">â‚¹<%= cart ? cart.total_price.toFixed(2) : '0.00' %></p>
                  </div>
                  <hr />
                  <div class="mt-3">
                    <a href="/checkOutPage" class="btn btn-success w-100 shadow-0 mb-2"> Make Purchase </a>
                    <a href="/userHomePage" class="btn btn-light w-100 border mt-2"> Back to shop </a>
                  </div>
                </div>
              </div>
            </div>
           
          </div>
        </div>
      </section>
      <!-- footer section -->
      <footer id="colorlib-footer" role="contentinfo">
        <div class="container">
          <div class="row row-pb-md">
            <div class="col footer-col colorlib-widget">
              <h4>About Footwear</h4>
              <p>Even the all-powerful Pointing has no control about the blind texts it is an almost
                unorthographic life</p>
              <p>
              <ul class="colorlib-social-icons">
                <li><a href="#"><i class="icon-twitter"></i></a></li>
                <li><a href="#"><i class="icon-facebook"></i></a></li>
                <li><a href="#"><i class="icon-linkedin"></i></a></li>
                <li><a href="#"><i class="icon-dribbble"></i></a></li>
              </ul>
              </p>
            </div>
            <div class="col footer-col colorlib-widget">
              <h4>Customer Care</h4>
              <p>
              <ul class="colorlib-footer-links">
                <li><a href="#">Contact</a></li>
                <li><a href="#">Returns/Exchange</a></li>
                <li><a href="#">Gift Voucher</a></li>
                <li><a href="#">Wishlist</a></li>
                <li><a href="#">Special</a></li>
                <li><a href="#">Customer Services</a></li>
                <li><a href="#">Site maps</a></li>
              </ul>
              </p>
            </div>
            <div class="col footer-col colorlib-widget">
              <h4>Information</h4>
              <p>
              <ul class="colorlib-footer-links">
                <li><a href="#">About us</a></li>
                <li><a href="#">Delivery Information</a></li>
                <li><a href="#">Privacy Policy</a></li>
                <li><a href="#">Support</a></li>
                <li><a href="#">Order Tracking</a></li>
              </ul>
              </p>
            </div>
  
            <div class="col footer-col">
              <h4>News</h4>
              <ul class="colorlib-footer-links">
                <li><a href="blog.html">Blog</a></li>
                <li><a href="#">Press</a></li>
                <li><a href="#">Exhibitions</a></li>
              </ul>
            </div>
  
            <div class="col footer-col">
              <h4>Contact Information</h4>
              <ul class="colorlib-footer-links">
                <li>291 South 21th Street, <br> Suite 721 New York NY 10016</li>
                <li><a href="tel://1234567920">+ 1235 2355 98</a></li>
                <li><a href="mailto:info@yoursite.com">info@yoursite.com</a></li>
                <li><a href="#">yoursite.com</a></li>
              </ul>
            </div>
          </div>
        </div>
        <div class="copy">
          <div class="row">
            <div class="col-sm-12 text-center">
              <p>
                <span>
                  Copyright &copy;
                  <script>document.write(new Date().getFullYear());</script> All rights reserved | This
                  template is made with <i class="icon-heart" aria-hidden="true"></i> by <a
                    href="https://colorlib.com" target="_blank">Colorlib</a>
                  
                </span>
                <span class="block">Demo Images: <a href="http://unsplash.co/" target="_blank">Unsplash</a>
                  , <a href="http://pexels.com/" target="_blank">Pexels.com</a></span>
              </p>
            </div>
          </div>
        </div>
      </footer>
  



  <script src="/js/jquery-3.4.1.min.js"></script>
  <!-- popper js -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
  </script>
  <!-- bootstrap js -->
  <script src="/js/bootstrap.js"></script>
  <!-- owl slider -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js">
  </script>
  <!-- isotope js -->
  <script src="https://unpkg.com/isotope-layout@3.0.4/dist/isotope.pkgd.min.js"></script>
  <!-- nice select -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-nice-select/1.1.0/js/jquery.nice-select.min.js"></script>
  <!-- custom js -->
  <script src="/js/custom.js"></script>
  <!-- Google Map -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCh39n5U-4IoWpsVGUHWdqB6puEkhRLdmI&callback=myMap">
  </script>
  <!-- End Google Map -->   
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Bootstrap 5 JavaScript and Popper.js (for dropdowns) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


<!-- Enable tooltips -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
  });
</script>


<script>
document.addEventListener('DOMContentLoaded', function() {
  const quantityControls = document.querySelectorAll('.quantity-control');

  quantityControls.forEach(control => {
    const minusBtn = control.querySelector('.minus');
    const plusBtn = control.querySelector('.plus');
    const input = control.querySelector('.quantity-input');
    const cartItem = control.closest('.cart-item');
    const itemId = cartItem.dataset.itemId;
    const priceElement = cartItem.querySelector('.price-value');
    const originalPrice = parseFloat(priceElement.textContent) / parseInt(input.value);

    minusBtn.addEventListener('click', () => updateQuantity(-1));
    plusBtn.addEventListener('click', () => updateQuantity(1));

    function updateQuantity(change) {
      let newQuantity = parseInt(input.value) + change;
      const maxQuantity = 5;
      const minQuantity = 1;

      if (newQuantity > maxQuantity) {
        Swal.fire({
          icon: 'warning',
          title: 'Maximum Quantity Reached',
          text: 'You can only order up to 5 units of this item.',
        });
        return;
      }

      newQuantity = Math.max(minQuantity, Math.min(newQuantity, maxQuantity));

      updateCartOnServer(itemId, newQuantity)
        .then(response => {
          if (response.success) {
            input.value = newQuantity;
            const newPrice = originalPrice * newQuantity;
            priceElement.textContent = newPrice.toFixed(2);
            updateTotalPrice();
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Oops...',
              text: response.message || 'Failed to update quantity',
            });
          }
        })
        .catch(error => {
          console.error('Error updating cart:', error);
          Swal.fire({
            icon: 'error',
            title: 'Oops...',
            text: 'An error occurred while updating the cart',
          });
        });
    }
  });

  function updateCartOnServer(itemId, quantity) {
    return fetch('/update-cart-quantity', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ itemId, quantity }),
    })
    .then(response => response.json());
  }

  function updateTotalPrice() {
    const priceElements = document.querySelectorAll('.price-value');
    const total = Array.from(priceElements).reduce((sum, el) => sum + parseFloat(el.textContent), 0);
    document.getElementById('cart-total').textContent = total.toFixed(2);
  }
});



document.querySelectorAll('.remove-item-btn').forEach(button => {
  button.addEventListener('click', function() {
    const itemId = this.getAttribute('data-item-id');
    Swal.fire({
      title: 'Are you sure?',
      text: "Do you want to remove this item from your cart?",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, remove it!'
    }).then((result) => {
      if (result.isConfirmed) {
        fetch('/remove-cart-item', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ itemId: itemId }),
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            Swal.fire(
              'Removed!',
              'Item has been removed from your cart.',
              'success'
            ).then(() => {
              
              window.location.reload();
            });
          } else {
            Swal.fire(
              'Error!',
              data.message,
              'error'
            );
          }
        })
        .catch(error => {
          console.error('Error:', error);
          Swal.fire(
            'Oops!',
            'An error occurred while removing the item.',
            'error'
          );
        });
      }
    });
  });
});


document.getElementById('applyCouponForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const couponCode = document.getElementById('couponCode').value;

    fetch('/apply-coupon', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ couponCode }),
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('couponResult');
        if (data.success) {
            resultDiv.innerHTML = `
                <p class="text-success">Coupon applied successfully!</p>
                <p>Your Code: ${data.couponCode}</p>
                <p>Discount Amount: ${data.discountAmount}</p>
                <button onclick="removeCoupon()">Remove Coupon</button>
            `;
            
        } else {
            resultDiv.innerHTML = `<p class="text-danger">${data.message}</p>`;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('couponResult').innerHTML = '<p>An error occurred while applying the coupon</p>';
    });
});


function removeCoupon() {
    fetch('/remove-coupon', {
        method: 'POST',
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('couponResult').innerHTML = '<p>Coupon removed successfully</p>';
            
        } else {
            document.getElementById('couponResult').innerHTML = `<p>${data.message}</p>`;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        document.getElementById('couponResult').innerHTML = '<p>An error occurred while removing the coupon</p>';
    });
}
</script>


</body>
</html>